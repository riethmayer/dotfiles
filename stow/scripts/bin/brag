#!/usr/bin/env bash
# Add entry to brag-book
#
# Storage: JSONL (JSON Lines) append-only log format
# Location: $XDG_DATA_HOME/brag-book/{date}.jsonl
# Each line is a complete JSON object - easy to grep, stream, append

set -euo pipefail

# Source the shared library (resolve symlinks)
SCRIPT_DIR="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")" && pwd)"
source "$SCRIPT_DIR/brag-lib.sh"

# Parse command line options
case "${1:-}" in
  -l|--list)
    brag_list "${2:-7}"
    exit 0
    ;;
  -h|--help)
    echo "Usage: brag [options] [description]"
    echo "Options:"
    echo "  -l, --list [days]  List recent entries (default: 7 days)"
    echo "  -h, --help         Show this help"
    echo ""
    echo "Without options, prompts for a description to add to brag book"
    exit 0
    ;;
esac

# Get description from args or prompt
if [[ -n "${1:-}" ]]; then
  description="$*"
else
  echo "What did you work on?"
  read -r description
fi

# Write the entry
brag_write_entry "$description" "manual"
